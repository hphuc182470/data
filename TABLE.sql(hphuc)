CREATE DATABASE VINABOOK
USE VINABOOK

CREATE TABLE DANHMUC(
	MaDM INT identity(01,1) NOT NULL PRIMARY KEY,
	TenDM NVARCHAR(200)
)

CREATE TABLE PHATHANHSACH(
	MAPHATHANH INT identity NOT NULL PRIMARY KEY,
	TENNPT NVARCHAR(200),
)
CREATE TABLE SACH(
	MASACH INT identity(01,1) NOT NULL PRIMARY KEY,
	TENSACH NVARCHAR(200),
	GIATIEN FLOAT,
	SLTONKHO INT,
	NGAYNHAPHANG DATE,
	NHAXUATBAN NVARCHAR(200),
	MAPHATHANH INT NOT NULL, 
	CONSTRAINT FK_MAPHATHANH1 FOREIGN KEY(MAPHATHANH) REFERENCES PHATHANHSACH(MAPHATHANH)

)
create table KHACHHANG(
	MAKH INT identity(01,1) NOT NULL PRIMARY KEY,
	TENKH NVARCHAR(200),
	SDT BIGINT,
	DIACHI NVARCHAR(MAX),
	Email VARCHAR(MAX),
	Account VARCHAR(MAX),
	Pass VARCHAR(MAX),
)
create table TACGIA(
	MATG INT identity NOT NULL PRIMARY KEY,
	TENTG NVARCHAR(MAX),
	TIEUSUTG NVARCHAR(MAX)
)
CREATE TABLE NHANVIEN(
	MANV INT identity(1000,1) NOT NULL PRIMARY KEY,
	TENNV NVARCHAR(MAX),
	GIOITINH NVARCHAR(MAX),
	VITRI NVARCHAR(MAX),
	NGAYSINH NVARCHAR(MAX),
	NGAYTHUE NVARCHAR(MAX),
	DIACHINV NVARCHAR(MAX),
	SDT BIGINT
)
create table shipper(
	MASHIPPER INT identity(01,1) NOT NULL PRIMARY KEY,
	TENCTY NVARCHAR(MAX),
	SDTCTY BIGINT
)
CREATE TABLE BINHLUAN(
	MABL INT identity(01,1) NOT NULL PRIMARY KEY,
	MAKH INT NOT NULL,
	MASACH INT NOT NULL,
	CONSTRAINT FK_MAKH1 FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH),
	CONSTRAINT FK_MASACH1 FOREIGN KEY(MASACH) REFERENCES SACH(MASACH),
	DANHGIA VARCHAR(MAX)
)
CREATE TABLE DONHANG(
	MADH INT identity(01,1) NOT NULL PRIMARY KEY,
	TENSHIPPER NVARCHAR(MAX),
	SDTSHIPPER BIGINT,
	DIACHIGH NVARCHAR(MAX),
	MAKH INT NOT NULL,
	MANV INT NOT NULL,
	MASHIPPER INT NOT NULL,
	CONSTRAINT FK_MAKH2 FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH),
	CONSTRAINT FK_MANV1 FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
	CONSTRAINT FK_MASHIPPER1 FOREIGN KEY(MASHIPPER) REFERENCES SHIPPER(MASHIPPER),
	PTDATHANG NVARCHAR(MAX),
	NGAYDATHANG DATE,
	NGAYDUDINHSHIP DATE
)
CREATE TABLE DONHANG_CHITIET(
	MADH INT NOT NULL,
	MASACH INT NOT NULL,
	CONSTRAINT PR_MADH_MASACH PRIMARY KEY(MADH, MASACH),
	CONSTRAINT FK_MADH FOREIGN KEY(MADH) REFERENCES DONHANG(MADH),
	CONSTRAINT FK_MASACH FOREIGN KEY(MASACH) REFERENCES SACH(MASACH)
)
CREATE TABLE SANGTAC(
	MATG INT NOT NULL,
	MASACH INT NOT NULL,
	NAMST DATE,
	CONSTRAINT PR_MATG_MASACH PRIMARY KEY(MATG, MASACH),
	CONSTRAINT FK_MATG FOREIGN KEY(MATG) REFERENCES TACGIA(MATG),
	CONSTRAINT FK_MASACH2 FOREIGN KEY(MASACH) REFERENCES SACH(MASACH)
)
CREATE TABLE DANHMUC_CHITIET(
	MaDM INT NOT NULL,
	MASACH INT NOT NULL,
	THELOAI NVARCHAR(MAX),
	CONSTRAINT PR_MaDMG_MASACH PRIMARY KEY(MaDM, MASACH),
	CONSTRAINT FK_MaDM FOREIGN KEY(MaDM) REFERENCES DANHMUC(MaDM),
	CONSTRAINT FK_MASACH3 FOREIGN KEY(MASACH) REFERENCES SACH(MASACH)
)
CREATE TABLE HOPTAC(
	MATG INT NOT NULL,
	MAPHATHANH INT NOT NULL,
	NGAYKIHOPDONG DATE,
	NGAYHETHAN DATE,
	CONSTRAINT PR_MATG_MAPHATHANH PRIMARY KEY(MATG, MAPHATHANH),
	CONSTRAINT FK_MATG3 FOREIGN KEY(MATG) REFERENCES TACGIA(MATG),
	CONSTRAINT FK_MAPHATHANH FOREIGN KEY(MAPHATHANH) REFERENCES PHATHANHSACH(MAPHATHANH)
)
